# Gotenx

トカマク型核融合炉のプラズマシミュレーションと可視化のための macOS アプリケーション

## 概要

Gotenx は、トカマク型核融合炉の炉心プラズマ輸送をシミュレーションし、結果をインタラクティブに可視化するネイティブ macOS アプリケーションです。Google DeepMind の TORAX シミュレータの Swift 実装である [swift-gotenx](https://github.com/1amageek/swift-gotenx) を使用し、Apple Silicon の GPU で高速計算を実現します。

研究者やエンジニアがプラズマの温度・密度分布の時間発展を直感的に理解できるツールを目指しています。

## 主な機能

### 🚀 シミュレーション実行
- **リアルタイム進捗監視**: 計算の進行状況と現在のプラズマ状態をライブ表示
- **設定プリセット**: ITER などの代表的なトカマク設定を簡単に読み込み
- **カスタム設定**: メッシュサイズ、境界条件、輸送モデルを自由に調整
- **バックグラウンド実行**: 複数のシミュレーションを並行実行

### 📊 インタラクティブ可視化
- **2D プロファイルプロット**: イオン・電子温度、密度、安全係数などのプロファイル
- **3D サーフェスプロット**: 時間方向を含めた 3 次元可視化
- **時系列アニメーション**: タイムスライダーで時間発展を再生
- **比較表示**: 複数のシミュレーション結果を重ねて比較

### 💾 結果管理
- **ワークスペース管理**: プロジェクトとシミュレーションを階層的に整理
- **スナップショット**: 任意の時刻にブックマークを追加
- **エクスポート**: PNG、PDF、CSV、JSON 形式で結果を出力
- **永続化**: シミュレーション結果を自動保存し、いつでも再読み込み可能

### 🧮 物理モデル
- **QLKNN ニューラルネットワーク**: QuaLiKiz より 4〜6 桁高速な乱流輸送予測
- **Bohm-GyroBohm 輸送**: 経験的輸送モデル
- **核融合出力**: Bosch-Hale 反応率による核融合出力計算
- **オーミック加熱**: ジュール加熱による温度上昇
- **制動放射**: 電子による放射損失

## インターフェース

### 3 カラムレイアウト

Gotenx は macOS 標準の 3 カラムデザインを採用しています：

```
┌──────────────────────────────────────────────────────────────────┐
│  [▶︎] [⏸] [⏹]    ━━━━━━━ 45%    t=0.45s/2.0s    [⚙️] [📁] [💾]  │ ← ツールバー
├─────────────┬──────────────────────────────────┬─────────────────┤
│             │                                  │                 │
│ サイドバー   │       メインキャンバス             │  インスペクタ    │
│             │                                  │                 │
│ 📁 プロジェクト│  ┌────────────────────────────┐  │ 📊 プロット     │
│ ├─ ITER-1   │  │                            │  │ ├─ 種類        │
│ │  ├─ 設定  │  │    温度プロファイル          │  │ ├─ スタイル     │
│ │  └─ 結果  │  │    (イオン温度 vs 半径)      │  │ └─ エクスポート │
│ │     ├─ t=0│  │                            │  │                 │
│ │     ├─ t=1│  │                            │  │ 📐 データ       │
│ │     └─ t=2│  └────────────────────────────┘  │ ├─ 統計        │
│ └─ ITER-2   │                                  │ └─ 選択        │
│             │  [時間  ━━━━━●━━━━━━━━ ]         │                 │
│ [+ 新規]     │  0.0s              2.0s          │ ⚙️ 設定        │
│             │                                  │ ├─ パラメータ   │
│             │  [Ti] [Te] [ne] [Q] [3D]        │ └─ 検証        │
│             │                                  │                 │
└─────────────┴──────────────────────────────────┴─────────────────┘
```

### ツールバー

- **▶︎ 実行**: シミュレーション開始（⌘R）
- **⏸ 一時停止**: 計算を一時停止
- **⏹ 停止**: 計算を停止してリセット
- **進捗バー**: 計算の進行状況をリアルタイム表示
- **⚙️ 設定**: アプリケーション設定
- **📁 開く**: プロジェクトや設定ファイルを読み込み
- **💾 保存**: ワークスペースを保存
- **📤 エクスポート**: 結果をエクスポート

### サイドバー（プロジェクトナビゲーター）

ワークスペース内のシミュレーションを階層的に表示：

```
📁 ワークスペース
├── 📊 ITER-like (QLKNN) ●実行中
│   ├── 📝 設定
│   └── 📈 結果 (23 スナップショット)
│       ├── 🔖 t = 0.0s (初期状態) ⭐ブックマーク
│       ├── ⏱️ t = 0.1s
│       ├── ⏱️ t = 0.2s
│       ⋮
│       └── ⏱️ t = 2.0s (最終状態)
│
├── 📊 Bohm-GyroBohm ✓完了
│   ├── 📝 設定
│   └── 📈 結果 (18 スナップショット)
│
└── 📊 比較: ITER vs Bohm
    └── 📊 差分プロット
```

**ステータスアイコン**:
- **●** 実行中（アニメーション）
- **⏸** 一時停止中
- **✓** 完了
- **⚠️** 失敗
- **○** 下書き

### メインキャンバス（中央）

シミュレーション結果のプロット表示エリア：

- **Swift Charts によるプロット**: ネイティブな macOS ルックアンドフィール
- **タイムスライダー**: 時間軸をドラッグして任意の時刻のプロファイルを表示
- **プロットタイプ切り替え**: [Ti] [Te] [ne] [Q] [3D] ボタンで表示内容を切り替え
- **インタラクティブ**: ズーム、パン、ツールチップ表示

**表示できるプロファイル**:
- **Ti**: イオン温度 [keV]
- **Te**: 電子温度 [keV]
- **ne**: 電子密度 [10²⁰ m⁻³]
- **psi**: ポロイダル磁束 [Wb/rad]
- **Q**: 安全係数
- **3D**: 時間 × 半径のサーフェスプロット

### インスペクタ（右側）

選択中のシミュレーションの詳細情報と設定：

**📊 プロットタブ**:
- プロット種類の選択
- 表示スタイル（線の太さ、色、凡例）
- PNG/PDF エクスポート

**📐 データタブ**:
- コアプラズマ統計（平均温度、最大密度など）
- 派生量（プラズマ電流、核融合利得 Q）
- 選択中のスナップショット詳細

**⚙️ 設定タブ**:
- メッシュ設定（セル数、主半径、小半径）
- 境界条件（温度、密度）
- 輸送モデル（QLKNN、Bohm-GyroBohm）
- 時間設定（終了時間、初期タイムステップ）
- リアルタイム検証とエラー表示

## 使い方

### 基本的なワークフロー

1. **新規シミュレーション作成**
   - サイドバーの `[+ 新規]` ボタンをクリック
   - プリセットから選択（ITER-like、簡易モデルなど）
   - または設定を手動で入力

2. **パラメータ調整**
   - インスペクタの **設定タブ** でパラメータを編集
   - メッシュサイズ、境界条件、輸送モデルを設定
   - リアルタイムで設定の妥当性を検証

3. **シミュレーション実行**
   - ツールバーの **▶︎ 実行** ボタンをクリック（⌘R）
   - 進捗バーとリアルタイムプロットで進行状況を監視
   - 必要に応じて **⏸ 一時停止** や **⏹ 停止**

4. **結果の可視化**
   - タイムスライダーで任意の時刻のプロファイルを表示
   - プロットタイプボタン（[Ti] [Te] [ne] など）で表示内容を切り替え
   - スナップショットにブックマークを追加して後で参照

5. **比較と分析**
   - 複数のシミュレーションを実行
   - サイドバーから比較したいシミュレーションを選択
   - 比較ビューで結果を重ねて表示

6. **エクスポート**
   - インスペクタの **プロットタブ** から PNG/PDF で図をエクスポート
   - ツールバーの **📤 エクスポート** から CSV/JSON でデータをエクスポート

### プリセット設定

以下のプリセットが用意されています：

- **ITER-like (QLKNN)**: ITER 相当のパラメータで QLKNN 輸送モデルを使用
- **Bohm-GyroBohm**: 経験的輸送モデルを使用（高速）
- **High-Beta Test**: 高ベータ運転のテストケース
- **Minimal**: 最小限の設定（デバッグ用）

## 動作環境

- **macOS 26.0 以降**（推奨: Apple Silicon Mac）
- **Xcode 16.0 以降**（開発者向け）
- **ディスク空き容量**: 500 MB 以上（シミュレーション結果保存用）
- **メモリ**: 8 GB 以上推奨

**注意**: QLKNN ニューラルネットワーク輸送モデルは macOS のみで利用可能です。iOS 版では Bohm-GyroBohm 輸送モデルが使用されます。

## インストール

### App Store から（将来対応予定）

App Store で「Gotenx」を検索してインストール

### ソースからビルド（開発者向け）

1. **リポジトリをクローン**:
   ```bash
   cd ~/Desktop
   git clone https://github.com/yourusername/Gotenx.git
   git clone https://github.com/1amageek/swift-gotenx.git
   ```

2. **Xcode で開く**:
   ```bash
   cd Gotenx
   open Gotenx.xcodeproj
   ```

3. **swift-gotenx 依存関係を追加**:
   - Xcode でプロジェクトを選択
   - ターゲット → 一般 → フレームワーク
   - パッケージ依存関係を追加 → ローカルを追加
   - `~/Desktop/swift-gotenx` を選択
   - 製品を選択: `Gotenx`、`GotenxPhysics`、`GotenxUI`

4. **ビルドして実行**:
   - `⌘R` を押すか、製品 → 実行

## スクリーンショット

*(準備中)*

## データの保存場所

シミュレーション結果は以下の場所に保存されます：

```
~/Library/Application Support/Gotenx/
├── simulations/
│   ├── {simulation-id-1}/
│   │   ├── config.json     # シミュレーション設定
│   │   └── result.json     # 完全な時系列データ
│   ├── {simulation-id-2}/
│   └── ...
└── Gotenx.sqlite           # ワークスペースメタデータ（SwiftData）
```

## 技術スタック

- **UI**: SwiftUI + Liquid Glass デザインシステム（iOS 26.0+）
- **データ永続化**: SwiftData（メタデータ）+ ファイルベースストレージ（シミュレーション結果）
- **並行処理**: Swift Concurrency（async/await、アクター）
- **シミュレーションエンジン**: [swift-gotenx](https://github.com/1amageek/swift-gotenx)
- **可視化**: Swift Charts、GotenxUI
- **GPU 計算**: MLX-Swift（Apple Silicon 最適化）

## ライセンス

MIT ライセンス。詳細は `LICENSE` を参照してください。

## 関連プロジェクト

- **swift-gotenx**: https://github.com/1amageek/swift-gotenx
- **Google DeepMind TORAX**: https://github.com/google-deepmind/torax
- **MLX-Swift**: https://github.com/ml-explore/mlx-swift

## 参考文献

- **TORAX 論文**: [arXiv:2406.06718v2](https://arxiv.org/abs/2406.06718)
- **QLKNN 論文**: van de Plassche et al., "Fast modeling of turbulent transport in fusion plasmas using neural networks", _Physics of Plasmas_ **27**, 022310 (2020)

---

質問やフィードバックは [GitHub Issues](https://github.com/yourusername/Gotenx/issues) でお願いします。
